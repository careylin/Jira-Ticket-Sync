({480:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};const t=figma.currentPage.parent;t.setRelaunchData({update_page:"",update_all:""});const i="COMPANY_NAME",n="PROJECT_ID",a="USERNAME",o="PASSWORD",r="ISSUE_ID",s="CREATE_LINK",l="LIBRARY_COMPONENT";var d,c,m,f,u,g;const y={family:"Work Sans",style:"Regular"},p={family:"Work Sans",style:"Medium"},h={family:"Work Sans",style:"Bold"};function v(e){return e.fields.statuscategorychangedate}function S(e){return e.fields.assignee.displayName}function T(e){return e.fields.description}var A=0;const E="Ticket ID",D="Ticket Title",C="Date of Status Change",I="Assignee",w="Description",R="Jira Ticket Header",_=j("EEEEEE"),b=j("FFEDC0"),N=j("D7E0FF"),k=j("C0E9BF "),x=j("B9B9B9"),P=j("FFD9D9");var M;if("update_selection"===figma.command)O("selection");else if("update_all"===figma.command)O("all");else if("update_page"===figma.command)O("page");else if("set_library_component"===figma.command)!function(t){e(this,void 0,void 0,(function*(){let e;"COMPONENT_SET"===t.type?(e=t.key,yield figma.clientStorage.setAsync(l,e),t.absoluteRenderBounds,t.setRelaunchData({remove_library_component:"The component will not be used anymore in new files."}),figma.closePlugin("Set as global JTS component. Make sure the component is published in a library.")):figma.closePlugin("Element is not a component set. Could not be saved as library component.")}))}(figma.currentPage.selection[0]);else if("remove_library_component"===figma.command){let t=figma.currentPage.selection[0];!function(t){e(this,void 0,void 0,(function*(){yield figma.clientStorage.deleteAsync(l),t.setRelaunchData({}),t.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),figma.closePlugin("Unpublished global JTS component.")}))}(t),t.setRelaunchData({remove_library_component:"Unpublish global component. It will not be used in other files anymore."})}else figma.showUI(__html__,{width:250,height:308}),z();function O(t){return e(this,void 0,void 0,(function*(){figma.showUI(__html__,{visible:!1}),yield z(),!U(t)||"all"!==t&&"page"!==t&&"selection"!==t||figma.closePlugin()}))}function z(){return e(this,void 0,void 0,(function*(){d=yield F(i,!0),c=yield F(n,!0),m=yield F(a,!1),f=yield F(o,!1),u=yield F(r,!1),""===(g=yield F(s,!1))&&(g=!0),figma.ui.postMessage({company_name:d,project_id:c,username:m,password:f,issueId:u,createLink:g,type:"setAuthorizationVariables"})}))}function F(i,n=!1){return e(this,void 0,void 0,(function*(){var e;return(e=n?t.getPluginData(i):yield figma.clientStorage.getAsync(i))||0==e||(e=""),e}))}function U(e){let i,n=!1;return"all"==e?(i=t.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===R)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found in document."),n=!0):$(i)):"page"==e?(i=figma.currentPage.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===R)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found on page."),n=!0):$(i)):"selection"==e&&(i=figma.currentPage.selection,i=i.filter((e=>e.name===R)),0==i.length?(figma.notify('No "Jira Ticket Header" instance selected.'),n=!0):$(i)),n}function $(t){return e(this,void 0,void 0,(function*(){var e=[],i=[],n=0;for(let a=0;a<t.length;a++){const o=t[a];if("INSTANCE"===o.type){let t=o.findOne((e=>"TEXT"===e.type&&e.name===E));t&&""!==t.characters?(i.push(t.characters),e.push(o.id)):n+=1}}n>0&&figma.notify(`${n} instance(s) is missing the text element 'Ticket ID' and could not be updated.`),0===i.length||0===e.length?figma.command&&figma.closePlugin():figma.ui.postMessage({nodeIds:e,issueIds:i,type:"getTicketData"})}))}function L(t,i,n=!1){return e(this,void 0,void 0,(function*(){var e,a=i.data,o=i.issueIds,r=t.length,s=[],l=0,c=0,m=0,f=[];for(let e=0;e<r;e++){let i=t[e],n=W(a[e],o[e]),r=n.fields.status.name;"Error"===r&&s.push(o[e]);let y=M.findChild((e=>e.name==="Status="+r));y||(y=M.defaultVariant,f.push(r));let p=i.findOne((e=>"TEXT"===e.type&&e.name===D));p?(yield figma.loadFontAsync(p.fontName),p.characters=n.fields.summary,p.hyperlink={type:"URL",value:`https://${d}/browse/${n.key}`}):l+=1;let h=i.findOne((e=>"TEXT"===e.type&&e.name===C));if(h){yield figma.loadFontAsync(h.fontName);var u=new Date(v(n).replace(/[T]+.*/,""));h.characters=u.toDateString()}else c+=1;let A=i.findOne((e=>"TEXT"===e.type&&e.name===I));if(A)if(yield figma.loadFontAsync(A.fontName),n.fields.assignee){let e=S(n);A.characters=e}else A.characters="Not assigned";else m+=1;let E=i.findOne((e=>"TEXT"===e.type&&e.name===w)),R=T(n);if(E&&R){let e="Helvetica",t={family:e,style:"Regular"};for(yield figma.loadFontAsync(t),E.fontName=t;R.match(/\n(\*)+[^\w]/);){let e=R.match(/\n(\*)+[^\w]/)[0].length;e=2*(e-2);var g=new Array(e).join(" ");R=R.replace(/\n(\*)+[^\w]/,`\n${g}â€¢ `)}E.characters=R;let i=/\{panel.*?}(.+?)\{panel\}/s,n={family:e,style:"Regular"};yield H(E,i,n,1,"-------","-------");let a=/\{noformat\}(.*?)\{noformat\}/s,o={family:"Courier",style:"Regular"};yield H(E,a,o,1,"-------\n","-------");let r=/\*(.+?)\*/,s={family:e,style:"Bold"};yield H(E,r,s,1);let l=/_([^_].*?)_/,d={family:e,style:"Oblique"};yield H(E,l,d,1);let c=/h([1-9])\.\s(.*)/,m={family:e,style:"Bold"};yield H(E,c,m,2)}i.swapComponent(y),i.setRelaunchData({update_selection:""})}if(f.length>0){let e=(f=[...new Set(f)]).join("', '");figma.notify(`Status '${e}' not existing. You can add it as a new variant to the main component.`,{timeout:6e3})}l>0&&figma.notify(`${l} tickets are missing text element 'Ticket Title'.`),c>0&&figma.notify(`${c} tickets are missing text element 'Date of Status Change'.`),m>0&&figma.notify(`${m} tickets are missing text element 'Assignee'.`);var y=s.length;return y==r?e=1==r?"Invalid ID.":`${y} of ${r} IDs are invalid or do not exist.`:0==y?(e=1==r?"Updated.":`${r} of ${r} header(s) updated!`,n&&(e="")):e=`${r-y} of ${r} successfully updated. `+(1==y?"1 ID is invalid or does not exist.":`${y} IDs are invalid or do not exist.`),"update_page"===figma.command||"update_all"===figma.command||"update_selection"===figma.command?figma.closePlugin(e):figma.notify(e,{timeout:2e3}),t}))}function H(t,i,n,a,o="",r=""){return e(this,void 0,void 0,(function*(){for(yield figma.loadFontAsync(n);t.characters.match(i);){let e=t.characters.match(i),s=e[0].length,l=e.index,d=e[a],c=o+d+r;s>0&&(t.deleteCharacters(l,l+s),t.insertCharacters(l,c),t.setRangeFontName(l,l+c.length,n))}return t}))}function B(t,i){return e(this,void 0,void 0,(function*(){var n=figma.createComponent();n.name=i,n.layoutMode="VERTICAL",n.resize(600,200),n.counterAxisSizingMode="FIXED",n.primaryAxisSizingMode="AUTO",n.paddingTop=24,n.paddingRight=24,n.paddingBottom=24,n.paddingLeft=24,n.itemSpacing=16,n.cornerRadius=4,n.fills=[{type:"SOLID",color:t}];var a=figma.createFrame();a.name="Container",a.layoutMode="HORIZONTAL",a.counterAxisSizingMode="AUTO",a.layoutAlign="STRETCH",a.itemSpacing=40,a.fills=[];var o=figma.createFrame();o.name="Container",o.layoutMode="HORIZONTAL",o.counterAxisSizingMode="AUTO",o.layoutAlign="STRETCH",o.itemSpacing=32,o.fills=[];var r=figma.createFrame();return r.name="Container",r.layoutMode="HORIZONTAL",r.counterAxisSizingMode="AUTO",r.layoutAlign="STRETCH",r.itemSpacing=32,r.cornerRadius=8,r.verticalPadding=16,r.horizontalPadding=16,r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],yield function(){return e(this,void 0,void 0,(function*(){yield figma.loadFontAsync(y),yield figma.loadFontAsync(p),yield figma.loadFontAsync(h)}))}().then((()=>{const e=figma.createText();e.fontName=y,e.fontSize=32,e.textDecoration="UNDERLINE",e.autoRename=!1,e.characters="Ticket title",e.name=D;const t=figma.createText();t.fontName=p,t.fontSize=32,t.autoRename=!1,t.characters="ID-1",t.name=E;const i=figma.createText();i.fontName=y,i.fontSize=24,i.autoRename=!1,i.characters="MM DD YYYY",i.name=C;const s=figma.createText();s.fontName=y,s.fontSize=24,s.autoRename=!1,s.characters="Name of assignee",s.name=I;const l=figma.createText();l.fontName=y,l.fontSize=24,l.autoRename=!1,l.characters="Description",l.name=w,l.layoutGrow=1,n.appendChild(a),n.appendChild(o),n.appendChild(r),a.appendChild(t),a.appendChild(e),o.appendChild(s),o.appendChild(i),r.appendChild(l),e.layoutGrow=1,s.layoutGrow=1})).catch((()=>{figma.notify("Font '"+y.family+"' could not be loaded. Please install the font.")})),a.primaryAxisSizingMode="FIXED",a.layoutAlign="STRETCH",o.primaryAxisSizingMode="FIXED",o.layoutAlign="STRETCH",r.primaryAxisSizingMode="FIXED",r.layoutAlign="STRETCH",n}))}function X(){return e(this,void 0,void 0,(function*(){let e;const i=[yield B(x,"Status=Default"),yield B(_,"Status=To Do"),yield B(b,"Status=In Progress"),yield B(N,"Status=In Review"),yield B(k,"Status=Done"),yield B(P,"Status=Error")];return e=figma.combineAsVariants(i,figma.currentPage),e.name=R,e.layoutMode="VERTICAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="AUTO",e.paddingTop=16,e.paddingRight=16,e.paddingBottom=16,e.paddingLeft=16,e.itemSpacing=24,e.cornerRadius=4,t.setPluginData("ticketComponentID",e.id),e.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2,e}))}function Y(t){return e(this,void 0,void 0,(function*(){var e;return yield figma.importComponentSetByKeyAsync(t).then((t=>{e=t})).catch((()=>{e=!1})),e}))}function J(e){if(!e)throw figma.notify("Something went wrong."),new Error("Something went wrong."+e);if("Error"==e.type)throw figma.notify("Could not get data. There seems to be no connection to the server."),new Error(e.message);if("Client must be authenticated to access this resource."==e[0].message)throw figma.notify("You have entered an invalid e-mail. See 'Authorization' settings."),new Error(e.message);if("Site temporarily unavailable"==e[0].errorMessage)throw figma.notify("Company domain name does not exist. See 'Project Settings'."),new Error(e[0].errorMessage);if(e[0][0])throw figma.notify("Could not access data. Your Jira API Token seems to be invalid. See 'Authorization' settings."),new Error(e[0][0]);return!0}function W(e,t){var i;return e&&e.key?i=e:e.errorMessages?i=V(`Error: ${e.errorMessages}`,t):(i=V("Error: An unexpected error occured.",t),figma.notify("Unexpected error."),console.error("Unexpected error.",e)),i}function V(e,t){return{key:t,fields:{summary:e,status:{name:"Error"},statuscategorychangedate:(new Date).toISOString()}}}function j(e){var t=parseInt(e,16);return{r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}}!function(){e(this,void 0,void 0,(function*(){let e=figma.root.findAllWithCriteria({types:["COMPONENT_SET"]});if(e=e.filter((e=>e.name===R)),e[0])M=e[0],t.setPluginData("ticketComponentID",M.id);else{var i=t.getPluginData(l);let e;if(i&&(e=yield Y(i)))M=e;else{var n=yield figma.clientStorage.getAsync(l);n&&(e=yield Y(n))?(t.setPluginData(l,n),M=e):M=yield X()}}}))}(),figma.ui.onmessage=l=>e(this,void 0,void 0,(function*(){if("create-component"===l.type&&(M=yield X(),t.setPluginData("ticketComponentID",M.id)),"create-new-ticket"===l.type&&J(l.data)){let t=yield function(t){return e(this,void 0,void 0,(function*(){let e=M.defaultVariant.createInstance();e.x=figma.viewport.center.x-e.width/2+A,e.y=figma.viewport.center.y-e.height/2+A,A=(A+10)%70,figma.currentPage.selection=[e];let i=W(t.data[0],t.issueIds[0]);e=(yield L([e],t,!0))[0];let n=e.findOne((e=>"TEXT"===e.type&&e.name===E));return n?(yield figma.loadFontAsync(n.fontName),n.characters=i.key):figma.notify("Could not find text element named 'Ticket ID'."),e}))}(l);if(l.createLink&&l.data[0].key&&""!=c){let e=encodeURIComponent(figma.root.name),i=encodeURIComponent(t.id),n=`https://www.figma.com/file/${c}/${e}?node-id=${i}`;figma.ui.postMessage({issueId:l.issueIds[0],link:n,type:"post-link-to-jira-issue"})}}if("update-all"===l.type&&U("all"),"update-page"===l.type&&U("page"),"update-selected"===l.type&&U("selection"),"authorization-detail-changed"===l.type&&function(l,y,p=!1){e(this,void 0,void 0,(function*(){p?t.setPluginData(l,y):yield figma.clientStorage.setAsync(l,y),l===i?d=y:l===n?c=y:l===a?m=y:l===o?f=y:l===r?u=y:l===s&&(g=y)}))}(l.key,l.data,l.save_public),"resize-ui"===l.type&&(l.big_size?figma.ui.resize(250,650):figma.ui.resize(250,308)),"create-visual-bell"===l.type&&figma.notify(l.message),"ticketDataSent"===l.type&&J(l.data)){var y=l.nodeIds.map((e=>figma.getNodeById(e)));yield L(y,l)}}))}})[480]();