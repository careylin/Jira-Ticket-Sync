({480:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const t=figma.currentPage.parent;t.setRelaunchData({open_plugin:"",update_all:""});const i="COMPANY_NAME",n="PROJECT_ID",a="USERNAME",o="PASSWORD",r="ISSUE_ID",l="CREATE_LINK",s="LIBRARY_COMPONENT";var d,c,m,u,f,g;const y={family:"Arial",style:"Regular"};ee(y);const p={family:"Inter",style:"Medium"},h={family:"Inter",style:"Regular"},v={family:"Helvetica",style:"Regular"},T=[{type:"SOLID",color:te("172B4D")}],S=[{type:"SOLID",color:te("6B778C")}],C=[{type:"SOLID",color:te("0065FF")}];function A(e){var t,i;return null===(i=null===(t=e.fields)||void 0===t?void 0:t.status)||void 0===i?void 0:i.name}function I(e){var t,i;return(null===(i=null===(t=e.fields)||void 0===t?void 0:t.assignee)||void 0===i?void 0:i.displayName)||"Not assigned"}function R(e){var t;return(null===(t=e.fields)||void 0===t?void 0:t.description)||"No description"}function E(e){var t,i;let n=null===(t=e.fields)||void 0===t?void 0:t.statuscategorychangedate;return n||null===(i=e.fields)||void 0===i||i.created,n}var D=0;const w="Ticket ID",N="Ticket Title",_="Date of Status Change",b="Assignee",k="Description",x="Status",O="Jira Ticket Header",P=te("5E6C84"),M=te("5E6C84"),z=te("0065FF"),L=te("00A3BF"),U=te("36B37E"),F=te("FF5630");var $;if("update_selection"===figma.command)H("selection");else if("update_all"===figma.command)H("all");else if("update_page"===figma.command)H("page");else if("set_library_component"===figma.command)!function(t){e(this,void 0,void 0,(function*(){let e;"COMPONENT_SET"===t.type?(e=t.key,yield figma.clientStorage.setAsync(s,e),t.absoluteRenderBounds,t.setRelaunchData({remove_library_component:"The component will not be used anymore in new files."}),figma.closePlugin("Set as global JTS component. Make sure the component is published in a library.")):figma.closePlugin("Element is not a component set. Could not be saved as library component.")}))}(figma.currentPage.selection[0]);else if("remove_library_component"===figma.command){let t=figma.currentPage.selection[0];!function(t){e(this,void 0,void 0,(function*(){yield figma.clientStorage.deleteAsync(s),t.setRelaunchData({}),t.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),figma.closePlugin("Unpublished global JTS component.")}))}(t),t.setRelaunchData({remove_library_component:"Unpublish global component. It will not be used in other files anymore."})}else figma.showUI(__html__,{width:250,height:308}),B();function H(t){return e(this,void 0,void 0,(function*(){figma.showUI(__html__,{visible:!1}),yield B(),!Y(t)||"all"!==t&&"page"!==t&&"selection"!==t||figma.closePlugin()}))}function B(){return e(this,void 0,void 0,(function*(){d=yield X(i,!0),c=yield X(n,!0),m=yield X(a,!1),u=yield X(o,!1),f=yield X(r,!1),""===(g=yield X(l,!1))&&(g=!0),figma.ui.postMessage({company_name:d,project_id:c,username:m,password:u,issueId:f,createLink:g,type:"setAuthorizationVariables"})}))}function X(i,n=!1){return e(this,void 0,void 0,(function*(){var e;return(e=n?t.getPluginData(i):yield figma.clientStorage.getAsync(i))||0==e||(e=""),e}))}function Y(e){let i,n=!1;return"all"==e?(i=t.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===O)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found in document."),n=!0):J(i)):"page"==e?(i=figma.currentPage.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===O)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found on page."),n=!0):J(i)):"selection"==e&&(i=figma.currentPage.selection,i=i.filter((e=>e.name===O)),0==i.length?(figma.notify('No "Jira Ticket Header" instance selected.'),n=!0):J(i)),n}function J(t){return e(this,void 0,void 0,(function*(){var e=[],i=[],n=0;for(let a=0;a<t.length;a++){const o=t[a];if("INSTANCE"===o.type){let t=o.findOne((e=>"TEXT"===e.type&&e.name===w));t&&""!==t.characters?(i.push(t.characters),e.push(o.id)):n+=1}}n>0&&figma.notify(`${n} instance(s) is missing the text element 'Ticket ID' and could not be updated.`),0===i.length||0===e.length?figma.command&&figma.closePlugin():figma.ui.postMessage({nodeIds:e,issueIds:i,type:"getTicketData"})}))}function V(t,i,n=!1){return e(this,void 0,void 0,(function*(){var e,a,o=i.data,r=i.issueIds,l=t.length,s=[],c=0,m=0,u=0,f=[];for(let i=0;i<l;i++){let n=t[i],a=q(o[i],r[i]),l=A(a);"Error"===l&&s.push(r[i]);let p=$.findChild((e=>e.name==="Status="+l));p||(p=$.defaultVariant,f.push(l));let h=n.findOne((e=>"TEXT"===e.type&&e.name===N));h?(h.fontName=yield ee(h.fontName),h.characters=(void 0,(null===(e=a.fields)||void 0===e?void 0:e.summary)||"ERROR: No summary existing."),h.hyperlink={type:"URL",value:`https://${d}/browse/${a.key}`}):c+=1;let T=n.findOne((e=>"TEXT"===e.type&&e.name===_));if(T&&E(a)){T.fontName=yield ee(T.fontName);var g=new Date(E(a).replace(/[T]+.*/,""));T.characters=g.toDateString()}else m+=1;let S=n.findOne((e=>"TEXT"===e.type&&e.name===b));S?(S.fontName=yield ee(S.fontName),S.characters=I(a)):u+=1;let C=n.findOne((e=>"TEXT"===e.type&&e.name===x));C&&(C.fontName=yield ee(S.fontName),C.characters=A(a));let D=n.findOne((e=>"TEXT"===e.type&&e.name===k)),w=R(a);if(D&&w){let e=yield ee(v);D.fontName=e;let t=e.family;for(;w.match(/\n(\*)+[^\w]/);){let e=w.match(/\n(\*)+[^\w]/)[0].length;e=2*(e-2);var y=new Array(e).join(" ");w=w.replace(/\n(\*)+[^\w]/,`\n${y}â€¢ `)}D.characters=w;let i=/\{panel.*?}(.+?)\{panel\}/s,n={family:t,style:"Regular"};yield j(D,i,n,1,"-------","-------");let a=/\{noformat\}(.*?)\{noformat\}/s,o={family:"Courier",style:"Regular"};yield j(D,a,o,1,"-------\n","-------");let r=/\[(https:.*)\|http.*\|smart-link]/,l={family:t,style:"Regular"};yield j(D,r,l,1,"","",!0);let s=/\*(.+?)\*/,d={family:t,style:"Bold"};yield j(D,s,d,1);let c=/_([^_].*?)_/,m={family:t,style:"Oblique"};yield j(D,c,m,1);let u=/h([1-9])\.\s(.*)/,f={family:t,style:"Bold"};yield j(D,u,f,2)}n.swapComponent(p),n.setRelaunchData({update_selection:""})}if(f.length>0){let e=(f=[...new Set(f)]).join("', '");figma.notify(`Status '${e}' not existing. You can add it as a new variant to the main component.`,{timeout:6e3})}c>0&&figma.notify(`${c} tickets are missing text element 'Ticket Title'.`),m>0&&figma.notify(`${m} tickets are missing text element 'Date of Status Change'.`),u>0&&figma.notify(`${u} tickets are missing text element 'Assignee'.`);var p=s.length;return p==l?a=1==l?"Invalid ID.":`${p} of ${l} IDs are invalid or do not exist.`:0==p?(a=1==l?"Updated.":`${l} of ${l} header(s) updated!`,n&&(a="")):a=`${l-p} of ${l} successfully updated. `+(1==p?"1 ID is invalid or does not exist.":`${p} IDs are invalid or do not exist.`),"update_page"===figma.command||"update_all"===figma.command||"update_selection"===figma.command?figma.closePlugin(a):figma.notify(a,{timeout:2e3}),t}))}function j(t,i,n,a,o="",r="",l=!1){return e(this,void 0,void 0,(function*(){for(n=yield ee(n);t.characters.match(i);){let e=t.characters.match(i),s=e[0].length,d=e.index,c=e[a],m=o+c+r,u=m.length;s>0&&(t.deleteCharacters(d,d+s),t.insertCharacters(d,m),t.setRangeFontName(d,d+u,n),l&&(t.setRangeHyperlink(d,d+u,{type:"URL",value:c}),t.setRangeFills(d,d+u,C),t.setRangeTextDecoration(d,d+u,"UNDERLINE")))}return t}))}function W(t,i){return e(this,void 0,void 0,(function*(){var e=figma.createComponent();e.name=i,e.resize(600,200),e.cornerRadius=16,e.itemSpacing=0,e.layoutMode="HORIZONTAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="FIXED",e.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}];var n=figma.createRectangle();n.resize(12,200),n.fills=[{type:"SOLID",color:t}],n.layoutAlign="STRETCH",n.layoutGrow=0,n.topLeftRadius=16,n.bottomLeftRadius=16,n.name="Status Color Indicator";var a=figma.createFrame();a.paddingTop=24,a.paddingRight=24,a.paddingBottom=24,a.paddingLeft=24,a.name="Container",a.layoutMode="VERTICAL",a.counterAxisSizingMode="AUTO",a.layoutAlign="STRETCH",a.layoutGrow=1,a.itemSpacing=8,a.fills=[];var o=figma.createFrame();o.name="Container",o.layoutMode="VERTICAL",o.counterAxisSizingMode="AUTO",o.layoutAlign="STRETCH",o.itemSpacing=16,o.fills=[];var r=figma.createFrame();r.name="Container",r.layoutMode="HORIZONTAL",r.counterAxisSizingMode="AUTO",r.layoutAlign="STRETCH",r.itemSpacing=8,r.fills=[];var l=figma.createFrame();l.name="Container",l.layoutMode="HORIZONTAL",l.counterAxisSizingMode="AUTO",l.layoutAlign="STRETCH",l.itemSpacing=32,l.cornerRadius=8,l.verticalPadding=16,l.horizontalPadding=16,l.fills=[{type:"SOLID",color:te("f4f5f7")}];const s=figma.createText();s.fontName=yield ee(p),s.fontSize=24,s.fills=T,s.textDecoration="UNDERLINE",s.autoRename=!1,s.characters="Ticket title",s.name=N;const d=figma.createText();d.fontName=yield ee(h),d.fontSize=16,d.fills=S,d.autoRename=!1,d.characters="ID-1",d.name=w;const c=figma.createText();c.fontName=yield ee(h),c.fontSize=16,c.fills=S,c.autoRename=!1,c.characters=i.replace("Status=",""),c.name=x;const m=c.clone();m.characters="MM DD YYYY",m.name=_;const u=c.clone();u.characters="Name of assignee",u.name=b;const f=c.clone();f.characters="/",f.name="/";const g=f.clone(),y=figma.createText();return y.fontName=yield ee(v),y.fontSize=16,y.fills=T,y.autoRename=!1,y.characters="Description",y.name=k,y.layoutGrow=1,e.appendChild(n),e.appendChild(a),a.appendChild(d),a.appendChild(o),o.appendChild(s),o.appendChild(r),o.appendChild(l),l.appendChild(y),r.appendChild(c),r.appendChild(f),r.appendChild(u),r.appendChild(g),r.appendChild(m),s.layoutAlign="STRETCH",a.primaryAxisSizingMode="FIXED",a.layoutAlign="STRETCH",r.primaryAxisSizingMode="FIXED",r.layoutAlign="STRETCH",l.primaryAxisSizingMode="FIXED",l.layoutAlign="STRETCH",e}))}function G(){return e(this,void 0,void 0,(function*(){let e;const i=[yield W(P,"Status=Backlog"),yield W(M,"Status=To Do"),yield W(z,"Status=In Progress"),yield W(L,"Status=In Review"),yield W(U,"Status=Done"),yield W(F,"Status=Error")];return e=figma.combineAsVariants(i,figma.currentPage),e.name=O,e.layoutMode="VERTICAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="AUTO",e.paddingTop=16,e.paddingRight=16,e.paddingBottom=16,e.paddingLeft=16,e.itemSpacing=24,e.cornerRadius=4,t.setPluginData("ticketComponentID",e.id),e.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2,e}))}function Z(t){return e(this,void 0,void 0,(function*(){var e;return yield figma.importComponentSetByKeyAsync(t).then((t=>{e=t})).catch((()=>{e=!1})),e}))}function K(e){if(!e)throw figma.notify("Something went wrong."),new Error("Something went wrong."+e);if("Error"==e.type)throw figma.notify("Could not get data. There seems to be no connection to the server."),new Error(e.message);if("Client must be authenticated to access this resource."==e[0].message)throw figma.notify("You have entered an invalid e-mail. See 'Authorization' settings."),new Error(e.message);if("Site temporarily unavailable"==e[0].errorMessage)throw figma.notify("Company domain name does not exist. See 'Project Settings'."),new Error(e[0].errorMessage);if(e[0][0])throw figma.notify("Could not access data. Your Jira API Token seems to be invalid. See 'Authorization' settings."),new Error(e[0][0]);return!0}function q(e,t){var i;return e&&e.key?i=e:e.errorMessages?i=Q(`Error: ${e.errorMessages}`,t):(i=Q("Error: An unexpected error occured.",t),figma.notify("Unexpected error."),console.error("Unexpected error.",e)),i}function Q(e,t){return{key:t,fields:{summary:e,status:{name:"Error"},statuscategorychangedate:(new Date).toISOString()}}}function ee(t){return e(this,void 0,void 0,(function*(){var e=y;return yield figma.loadFontAsync(t).then((()=>{e=t})).catch((()=>{console.log("Font '"+t.family+"' could not be loaded. Please install or change the component font."),e=y})),e}))}function te(e){var t=parseInt(e,16);return{r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}}!function(){e(this,void 0,void 0,(function*(){let e=figma.root.findAllWithCriteria({types:["COMPONENT_SET"]});if(e=e.filter((e=>e.name===O)),e[0])$=e[0],t.setPluginData("ticketComponentID",$.id);else{var i=t.getPluginData(s);let e;if(i&&(e=yield Z(i)))$=e;else{var n=yield figma.clientStorage.getAsync(s);n&&(e=yield Z(n))?(t.setPluginData(s,n),$=e):$=yield G()}}}))}(),figma.ui.onmessage=s=>e(this,void 0,void 0,(function*(){if("create-component"===s.type&&($=yield G(),t.setPluginData("ticketComponentID",$.id)),"create-new-ticket"===s.type&&K(s.data)){let t=yield function(t){return e(this,void 0,void 0,(function*(){let e=$.defaultVariant.createInstance();e.x=figma.viewport.center.x-e.width/2+D,e.y=figma.viewport.center.y-e.height/2+D,D=(D+10)%70,figma.currentPage.selection=[e];let i=q(t.data[0],t.issueIds[0]);e=(yield V([e],t,!0))[0];let n=e.findOne((e=>"TEXT"===e.type&&e.name===w));return n?(n.fontName=yield ee(n.fontName),n.characters=i.key):figma.notify("Could not find text element named 'Ticket ID'."),e}))}(s);if(s.createLink&&s.data[0].key&&""!=c){let e=encodeURIComponent(figma.root.name),i=encodeURIComponent(t.id),n=`https://www.figma.com/file/${c}/${e}?node-id=${i}`;figma.ui.postMessage({issueId:s.issueIds[0],link:n,type:"post-link-to-jira-issue"})}}if("update-all"===s.type&&Y("all"),"update-page"===s.type&&Y("page"),"update-selected"===s.type&&Y("selection"),"authorization-detail-changed"===s.type&&function(s,y,p=!1){e(this,void 0,void 0,(function*(){p?t.setPluginData(s,y):yield figma.clientStorage.setAsync(s,y),s===i?d=y:s===n?c=y:s===a?m=y:s===o?u=y:s===r?f=y:s===l&&(g=y)}))}(s.key,s.data,s.save_public),"resize-ui"===s.type&&(s.big_size?figma.ui.resize(250,650):figma.ui.resize(250,308)),"create-visual-bell"===s.type&&figma.notify(s.message),"ticketDataSent"===s.type&&K(s.data)){var y=s.nodeIds.map((e=>figma.getNodeById(e)));yield V(y,s)}}))}})[480]();