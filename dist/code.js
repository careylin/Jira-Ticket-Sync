({480:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const t=figma.currentPage.parent;t.setRelaunchData({open_plugin:"",update_all:""});const i="COMPANY_NAME",n="PROJECT_ID",a="USERNAME",o="PASSWORD",r="ISSUE_ID",l="CREATE_LINK",s="LIBRARY_COMPONENT";var d,c,m,f,u,g;const y={family:"Arial",style:"Regular"};ie(y);var p=new Set;const h={family:"Inter",style:"Medium"},v={family:"Inter",style:"Regular"},T={family:"Helvetica",style:"Regular"},S=16,C=[{type:"SOLID",color:ne("172B4D")}],R=[{type:"SOLID",color:ne("6B778C")}],A=[{type:"SOLID",color:ne("0065FF")}];function I(e){var t,i;return null===(i=null===(t=e.fields)||void 0===t?void 0:t.status)||void 0===i?void 0:i.name}function E(e){var t,i;return(null===(i=null===(t=e.fields)||void 0===t?void 0:t.assignee)||void 0===i?void 0:i.displayName)||"Not assigned"}function D(e){var t;return(null===(t=e.fields)||void 0===t?void 0:t.description)||"No description"}function w(e){var t,i;let n=null===(t=e.fields)||void 0===t?void 0:t.statuscategorychangedate;return n||null===(i=e.fields)||void 0===i||i.created,n}var N=0;const _="Ticket ID",b="Ticket Title",x="Date of Status Change",k="Assignee",O="Description",P="Status",M="Jira Ticket Header",z=ne("5E6C84"),L=ne("5E6C84"),U=ne("0065FF"),F=ne("00A3BF"),$=ne("36B37E"),H=ne("FF5630");var B;if("update_selection"===figma.command)X("selection");else if("update_all"===figma.command)X("all");else if("update_page"===figma.command)X("page");else if("set_library_component"===figma.command)!function(t){e(this,void 0,void 0,(function*(){let e;"COMPONENT_SET"===t.type?(e=t.key,yield figma.clientStorage.setAsync(s,e),t.absoluteRenderBounds,t.setRelaunchData({remove_library_component:"The component will not be used anymore in new files."}),figma.closePlugin("Set as global JTS component. Make sure the component is published in a library.")):figma.closePlugin("Element is not a component set. Could not be saved as library component.")}))}(figma.currentPage.selection[0]);else if("remove_library_component"===figma.command){let t=figma.currentPage.selection[0];!function(t){e(this,void 0,void 0,(function*(){yield figma.clientStorage.deleteAsync(s),t.setRelaunchData({}),t.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),figma.closePlugin("Unpublished global JTS component.")}))}(t),t.setRelaunchData({remove_library_component:"Unpublish global component. It will not be used in other files anymore."})}else figma.showUI(__html__,{width:250,height:308}),Y();function X(t){return e(this,void 0,void 0,(function*(){figma.showUI(__html__,{visible:!1}),yield Y(),!V(t)||"all"!==t&&"page"!==t&&"selection"!==t||figma.closePlugin()}))}function Y(){return e(this,void 0,void 0,(function*(){d=yield J(i,!0),c=yield J(n,!0),u=yield J(r,!0),m=yield J(a,!1),f=yield J(o,!1),""===(g=yield J(l,!1))&&(g=!0),figma.ui.postMessage({company_name:d,project_id:c,username:m,password:f,issueId:u,createLink:g,type:"setAuthorizationVariables"})}))}function J(i,n=!1){return e(this,void 0,void 0,(function*(){var e;return(e=n?t.getPluginData(i):yield figma.clientStorage.getAsync(i))||0==e||(e=""),e}))}function V(e){let i,n=!1;return"all"==e?(i=t.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===M)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found in document."),n=!0):j(i)):"page"==e?(i=figma.currentPage.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===M)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found on page."),n=!0):j(i)):"selection"==e&&(i=figma.currentPage.selection,i=i.filter((e=>e.name===M)),0==i.length?(figma.notify('No "Jira Ticket Header" instance selected.'),n=!0):j(i)),n}function j(t){return e(this,void 0,void 0,(function*(){var e=[],i=[],n=0;for(let a=0;a<t.length;a++){const o=t[a];if("INSTANCE"===o.type){let t=o.findOne((e=>"TEXT"===e.type&&e.name===_));t&&""!==t.characters?(i.push(t.characters),e.push(o.id)):n+=1}}n>0&&figma.notify(`${n} instance(s) is missing the text element 'Ticket ID' and could not be updated.`),0===i.length||0===e.length?figma.command&&figma.closePlugin():figma.ui.postMessage({nodeIds:e,issueIds:i,type:"getTicketData"})}))}function W(t,i,n=!1){return e(this,void 0,void 0,(function*(){var e,a,o=i.data,r=i.issueIds,l=t.length,s=[],c=0,m=0,f=0,u=[];for(let i=0;i<l;i++){let n=t[i],a=ee(o[i],r[i]),l=I(a);"Error"===l&&s.push(r[i]);let p=B.findChild((e=>e.name==="Status="+l));p||(p=B.defaultVariant,u.push(l)),n.swapComponent(p);let h=n.findOne((e=>"TEXT"===e.type&&e.name===b));h?(h.fontName=yield ie(h.fontName),h.characters=(void 0,(null===(e=a.fields)||void 0===e?void 0:e.summary)||"ERROR: No summary existing."),h.hyperlink={type:"URL",value:`https://${d}/browse/${a.key}`}):c+=1;let v=n.findOne((e=>"TEXT"===e.type&&e.name===x));if(v&&w(a)){v.fontName=yield ie(v.fontName);var g=new Date(w(a).replace(/[T]+.*/,""));v.characters=g.toDateString()}else m+=1;let S=n.findOne((e=>"TEXT"===e.type&&e.name===k));S?(S.fontName=yield ie(S.fontName),S.characters=E(a)):f+=1;let C=n.findOne((e=>"TEXT"===e.type&&e.name===P));C&&(C.fontName=yield ie(S.fontName),C.characters=I(a));let R=n.findOne((e=>"TEXT"===e.type&&e.name===O)),A=D(a);if(R&&A){let e=yield ie(T);R.fontName=e;let t=e.family;for(;A.match(/\n(\*)+[^\w]/);){let e=A.match(/\n(\*)+[^\w]/)[0].length;e=2*(e-2);var y=new Array(e).join(" ");A=A.replace(/\n(\*)+[^\w]/,`\n${y}â€¢ `)}R.characters=A;let i=/\{panel.*?}(.+?)\{panel\}/s,n={family:t,style:"Regular"};yield G(R,i,n,1,"-------","-------");let a=/\{noformat\}(.*?)\{noformat\}/s,o={family:"Courier",style:"Regular"};yield G(R,a,o,1,"-------\n","-------");let r=/\[(https:.*)\|http.*\|smart-link]/,l={family:t,style:"Regular"};yield G(R,r,l,1,"","",!0);let s=/\*(.+?)\*/,d={family:t,style:"Bold"};yield G(R,s,d,1);let c=/_([^_].*?)_/,m={family:t,style:"Oblique"};yield G(R,c,m,1);let f=/h([1-9])\.\s(.*)/,u={family:t,style:"Bold"};yield G(R,f,u,2)}n.setRelaunchData({update_selection:""})}if(u.length>0){let e=(u=[...new Set(u)]).join("', '");figma.notify(`Status '${e}' not existing. You can add it as a new variant to the main component.`,{timeout:6e3})}c>0&&figma.notify(`${c} tickets are missing text element 'Ticket Title'.`),m>0&&figma.notify(`${m} tickets are missing text element 'Date of Status Change'.`),f>0&&figma.notify(`${f} tickets are missing text element 'Assignee'.`);var h=s.length;return h==l?a=1==l?"Invalid ID.":`${h} of ${l} IDs are invalid or do not exist.`:0==h?(a=1==l?"Updated.":`${l} of ${l} header(s) updated!`,n&&(a="")):a=`${l-h} of ${l} successfully updated. `+(1==h?"1 ID is invalid or does not exist.":`${h} IDs are invalid or do not exist.`),p.size>0&&(figma.notify("Font(s) '"+[...p].join(", ")+"' could not be loaded. Please install the font or change the component font."),p.clear()),"update_page"===figma.command||"update_all"===figma.command||"update_selection"===figma.command?figma.closePlugin(a):figma.notify(a,{timeout:2e3}),t}))}function G(t,i,n,a,o="",r="",l=!1){return e(this,void 0,void 0,(function*(){for(n=yield ie(n);t.characters.match(i);){let e=t.characters.match(i),s=e[0].length,d=e.index,c=e[a],m=o+c+r,f=m.length;s>0&&(t.deleteCharacters(d,d+s),t.insertCharacters(d,m),t.setRangeFontName(d,d+f,n),l&&(t.setRangeHyperlink(d,d+f,{type:"URL",value:c}),t.setRangeFills(d,d+f,A),t.setRangeTextDecoration(d,d+f,"UNDERLINE")))}return t}))}function Z(t,i){return e(this,void 0,void 0,(function*(){var e=figma.createComponent();e.visible=!1;var n=figma.createRectangle(),a=figma.createFrame(),o=figma.createFrame(),r=figma.createFrame(),l=figma.createFrame();const s=figma.createText(),d=figma.createText(),c=figma.createText(),m=figma.createText(),f=figma.createText(),u=figma.createText(),g=figma.createText(),y=figma.createText();return e.appendChild(n),e.appendChild(a),a.appendChild(d),a.appendChild(o),o.appendChild(s),o.appendChild(r),o.appendChild(l),l.appendChild(y),r.appendChild(c),r.appendChild(u),r.appendChild(f),r.appendChild(g),r.appendChild(m),e.name=i,e.resize(600,200),e.cornerRadius=16,e.itemSpacing=0,e.layoutMode="HORIZONTAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="FIXED",e.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],n.resize(12,200),n.fills=[{type:"SOLID",color:t}],n.layoutAlign="STRETCH",n.layoutGrow=0,n.topLeftRadius=16,n.bottomLeftRadius=16,n.name="Status Color Indicator",a.paddingTop=24,a.paddingRight=24,a.paddingBottom=24,a.paddingLeft=24,a.name="Container",a.layoutMode="VERTICAL",a.counterAxisSizingMode="AUTO",a.layoutAlign="STRETCH",a.layoutGrow=1,a.itemSpacing=8,a.fills=[],o.name="Container",o.layoutMode="VERTICAL",o.counterAxisSizingMode="AUTO",o.layoutAlign="STRETCH",o.itemSpacing=16,o.fills=[],r.name="Container",r.layoutMode="HORIZONTAL",r.counterAxisSizingMode="AUTO",r.layoutAlign="STRETCH",r.itemSpacing=8,r.fills=[],l.name="Container",l.layoutMode="HORIZONTAL",l.counterAxisSizingMode="AUTO",l.layoutAlign="STRETCH",l.itemSpacing=32,l.cornerRadius=8,l.verticalPadding=16,l.horizontalPadding=16,l.fills=[{type:"SOLID",color:ne("f4f5f7")}],s.fontName=yield ie(h),s.fontSize=24,s.fills=C,s.textDecoration="UNDERLINE",s.autoRename=!1,s.characters="Ticket title",s.name=b,d.fontName=yield ie(v),d.fontSize=S,d.fills=R,d.autoRename=!1,d.characters="ID-1",d.name=_,c.fontName=yield ie(v),c.fontSize=S,c.fills=R,c.autoRename=!1,c.characters=i.replace("Status=",""),c.name=P,m.fontSize=S,m.fills=R,m.autoRename=!1,m.characters="MM DD YYYY",m.name=x,f.fontSize=S,f.fills=R,f.autoRename=!1,f.characters="Name of assignee",f.name=k,u.fontSize=S,u.fills=R,u.autoRename=!1,u.characters="/",u.name="/",g.fontSize=S,g.fills=R,g.autoRename=!1,g.characters="/",g.name="/",y.fontName=yield ie(T),y.fontSize=16,y.fills=C,y.autoRename=!1,y.characters="Description",y.name=O,y.layoutGrow=1,s.layoutAlign="STRETCH",a.primaryAxisSizingMode="FIXED",a.layoutAlign="STRETCH",r.primaryAxisSizingMode="FIXED",r.layoutAlign="STRETCH",l.primaryAxisSizingMode="FIXED",l.layoutAlign="STRETCH",e.visible=!0,e}))}function K(){return e(this,void 0,void 0,(function*(){let e;const i=[yield Z(z,"Status=Backlog"),yield Z(L,"Status=To Do"),yield Z(U,"Status=In Progress"),yield Z(F,"Status=In Review"),yield Z($,"Status=Done"),yield Z(H,"Status=Error")];return e=figma.combineAsVariants(i,figma.currentPage),e.name=M,e.layoutMode="VERTICAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="AUTO",e.paddingTop=16,e.paddingRight=16,e.paddingBottom=16,e.paddingLeft=16,e.itemSpacing=24,e.cornerRadius=4,t.setPluginData("ticketComponentID",e.id),e.setRelaunchData({set_library_component:"Publish the component in a library and then click this button."}),e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2,e}))}function q(t){return e(this,void 0,void 0,(function*(){var e;return yield figma.importComponentSetByKeyAsync(t).then((t=>{e=t})).catch((()=>{e=!1})),e}))}function Q(e){if(!e)throw figma.notify("Something went wrong."),new Error("Something went wrong."+e);if("Error"==e.type)throw figma.notify("Could not get data. There seems to be no connection to the server."),new Error(e.message);if("Client must be authenticated to access this resource."==e[0].message)throw figma.notify("You have entered an invalid e-mail. See 'Authorization' settings."),new Error(e.message);if("Site temporarily unavailable"==e[0].errorMessage)throw figma.notify("Company domain name does not exist. See 'Project Settings'."),new Error(e[0].errorMessage);if(e[0][0])throw figma.notify("Could not access data. Your Jira API Token seems to be invalid. See 'Authorization' settings."),new Error(e[0][0]);return!0}function ee(e,t){var i;return e&&e.key?i=e:e.errorMessages?i=te(`Error: ${e.errorMessages}`,t):(i=te("Error: An unexpected error occured.",t),figma.notify("Unexpected error."),console.error("Unexpected error.",e)),i}function te(e,t){return{key:t,fields:{summary:e,status:{name:"Error"},statuscategorychangedate:(new Date).toISOString()}}}function ie(t){return e(this,void 0,void 0,(function*(){var e=y;return yield figma.loadFontAsync(t).then((()=>{e=t})).catch((()=>{console.log("Font '"+t.family+"' could not be loaded. Please install or change the component font."),p.add(t.family),e=y})),e}))}function ne(e){var t=parseInt(e,16);return{r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}}!function(){e(this,void 0,void 0,(function*(){let e=figma.root.findAllWithCriteria({types:["COMPONENT_SET"]});if(e=e.filter((e=>e.name===M)),e[0])B=e[0],t.setPluginData("ticketComponentID",B.id);else{var i=t.getPluginData(s);let e;if(i&&(e=yield q(i)))B=e;else{var n=yield figma.clientStorage.getAsync(s);n&&(e=yield q(n))?(t.setPluginData(s,n),B=e):B=yield K()}}}))}(),figma.ui.onmessage=s=>e(this,void 0,void 0,(function*(){if("create-component"===s.type&&(B=yield K(),t.setPluginData("ticketComponentID",B.id)),"create-new-ticket"===s.type&&Q(s.data)){let t=yield function(t){return e(this,void 0,void 0,(function*(){let e=B.defaultVariant.createInstance();e.x=figma.viewport.center.x-e.width/2+N,e.y=figma.viewport.center.y-e.height/2+N,N=(N+10)%70,figma.currentPage.selection=[e];let i=ee(t.data[0],t.issueIds[0]);e=(yield W([e],t,!0))[0];let n=e.findOne((e=>"TEXT"===e.type&&e.name===_));return n?(n.fontName=yield ie(n.fontName),n.characters=i.key):figma.notify("Could not find text element named 'Ticket ID'."),e}))}(s);if(s.createLink&&s.data[0].key&&""!=c){let e=encodeURIComponent(figma.root.name),i=encodeURIComponent(t.id),n=`https://www.figma.com/file/${c}/${e}?node-id=${i}`;figma.ui.postMessage({issueId:s.issueIds[0],link:n,type:"post-link-to-jira-issue"})}}if("update-all"===s.type&&V("all"),"update-page"===s.type&&V("page"),"update-selected"===s.type&&V("selection"),"authorization-detail-changed"===s.type&&function(s,y,p=!1){e(this,void 0,void 0,(function*(){p?t.setPluginData(s,y):yield figma.clientStorage.setAsync(s,y),s===i?d=y:s===n?c=y:s===a?m=y:s===o?f=y:s===r?u=y:s===l&&(g=y)}))}(s.key,s.data,s.save_public),"resize-ui"===s.type&&(s.big_size?figma.ui.resize(250,650):figma.ui.resize(250,308)),"create-visual-bell"===s.type&&figma.notify(s.message),"ticketDataSent"===s.type&&Q(s.data)){var y=s.nodeIds.map((e=>figma.getNodeById(e)));yield W(y,s)}}))}})[480]();