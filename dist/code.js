({480:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};const t=figma.currentPage.parent;t.setRelaunchData({update_page:"",update_all:""});const i="COMPANY_NAME",n="PROJECT_ID",a="USERNAME",o="PASSWORD",r="ISSUE_ID",s="CREATE_LINK";var d,l,c,f,m,u;const g={family:"Work Sans",style:"Regular"},y={family:"Work Sans",style:"Medium"},p={family:"Work Sans",style:"Bold"};function h(e){return e.fields.statuscategorychangedate}function v(e){return e.fields.assignee.displayName}var T=0;const S="Ticket ID",A="Ticket Title",I="Date of Status Change",D="Assignee",E="Jira Ticket Header",w=Y("EEEEEE"),C=Y("FFEDC0"),k=Y("D7E0FF"),x=Y("D7E0FF"),N=Y("D3FFD2"),R=Y("B9B9B9"),_=Y("FFD9D9");var M;function F(t){return e(this,void 0,void 0,(function*(){figma.showUI(__html__,{visible:!1}),yield z(),console.log(1);var e=P(t);console.log(2),!e||"all"!==t&&"page"!==t&&"selection"!==t||figma.closePlugin()}))}function z(){return e(this,void 0,void 0,(function*(){d=yield O(i,!0),l=yield O(n,!0),c=yield O(a,!1),f=yield O(o,!1),m=yield O(r,!1),""===(u=yield O(s,!1))&&(u=!0),figma.ui.postMessage({company_name:d,project_id:l,username:c,password:f,issueId:m,createLink:u,type:"setAuthorizationVariables"})}))}function O(i,n=!1){return e(this,void 0,void 0,(function*(){var e;return(e=n?t.getPluginData(i):yield figma.clientStorage.getAsync(i))||0==e||(e=""),e}))}function P(e){let i,n=!1;return"all"==e?(i=t.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===E)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found in document."),n=!0):$(i)):"page"==e?(i=figma.currentPage.findAllWithCriteria({types:["INSTANCE"]}),i=i.filter((e=>e.name===E)),0==i.length?(figma.notify("No instances named 'Jira Ticket Header' found on page."),n=!0):$(i)):"selection"==e&&(i=figma.currentPage.selection,0==i.length?(figma.notify("Nothing selected."),n=!0):$(i)),n}function $(t){return e(this,void 0,void 0,(function*(){var e=[],i=[];for(let n=0;n<t.length;n++){const a=t[n];if("INSTANCE"!==a.type)figma.notify("The element needs to be an instance of Jira Ticket Header");else{let t=a.findOne((e=>"TEXT"===e.type&&e.name===S));t?(i.push(t.characters),e.push(a.id)):figma.notify("At least one instance is missing the text element 'Ticket ID'. Could not update.")}}figma.ui.postMessage({nodeIds:e,issueIds:i,type:"getTicketData"})}))}function U(t,i,n=!1){return e(this,void 0,void 0,(function*(){var e,a=i.data,o=i.issueIds,r=t.length,s=[],l=0,c=0,f=0,m=[];for(let e=0;e<r;e++){let i=t[e],n=B(a[e],o[e]),r=n.fields.status.name;"Error"===r&&s.push(o[e]);let g=M.findChild((e=>e.name==="Status="+r));g||(g=M.defaultVariant,m.push(r));let y=i.findOne((e=>"TEXT"===e.type&&e.name===A));y?(yield figma.loadFontAsync(y.fontName),y.characters=n.fields.summary,y.hyperlink={type:"URL",value:`https://${d}.atlassian.net/browse/${n.key}`}):l+=1;let p=i.findOne((e=>"TEXT"===e.type&&e.name===I));if(p){yield figma.loadFontAsync(p.fontName);var u=new Date(h(n).replace(/[T]+.*/,""));p.characters=u.toDateString()}else c+=1;let T=i.findOne((e=>"TEXT"===e.type&&e.name===D));if(T)if(yield figma.loadFontAsync(T.fontName),n.fields.assignee){let e=v(n);T.characters=e}else T.characters="Not assigned";else f+=1;i.swapComponent(g),i.setRelaunchData({update_selection:""})}if(m.length>0){let e=(m=[...new Set(m)]).join("', '");figma.notify(`Status '${e}' not existing. You can add it as new variant to the main component.`,{timeout:6e3})}l>0&&figma.notify(`${l} tickets are missing text element 'Ticket Title'.`),c>0&&figma.notify(`${c} tickets are missing text element 'Date of Status Change'.`),f>0&&figma.notify(`${f} tickets are missing text element 'Assignee'.`);var g=s.length;return g==r?e=1==r?"Invalid ID.":`${g} of ${r} IDs are invalid or do not exist.`:0==g?(e=1==r?"Updated.":`${r} of ${r} header(s) updated!`,n&&(e="")):e=`${r-g} of ${r} successfully updated. `+(1==g?"1 ID is invalid or does not exist.":`${g} IDs are invalid or do not exist.`),"update_page"===figma.command||"update_all"===figma.command||"update_selection"===figma.command?figma.closePlugin(e):figma.notify(e,{timeout:2e3}),t}))}function b(t,i){return e(this,void 0,void 0,(function*(){var n=figma.createComponent();n.name=i,n.layoutMode="VERTICAL",n.resize(600,200),n.counterAxisSizingMode="FIXED",n.primaryAxisSizingMode="AUTO",n.paddingTop=24,n.paddingRight=24,n.paddingBottom=24,n.paddingLeft=24,n.itemSpacing=16,n.cornerRadius=4,n.fills=[{type:"SOLID",color:t}];var a=figma.createFrame();a.name="Header",a.layoutMode="HORIZONTAL",a.counterAxisSizingMode="AUTO",a.layoutAlign="STRETCH",a.itemSpacing=40,a.fills=[];var o=figma.createFrame();return o.name="Header",o.layoutMode="HORIZONTAL",o.counterAxisSizingMode="AUTO",o.layoutAlign="STRETCH",o.itemSpacing=32,o.fills=[],function(){return e(this,void 0,void 0,(function*(){yield figma.loadFontAsync(g),yield figma.loadFontAsync(y),yield figma.loadFontAsync(p)}))}().then((()=>{const e=figma.createText();e.fontName=g,e.fontSize=32,e.textDecoration="UNDERLINE",e.autoRename=!1,e.characters="Ticket title",e.name=A;const t=figma.createText();t.fontName=y,t.fontSize=32,t.autoRename=!1,t.characters="ID-1",t.name=S;const i=figma.createText();i.fontName=g,i.fontSize=24,i.autoRename=!1,i.characters="MM DD YYYY",i.name=I;const r=figma.createText();r.fontName=g,r.fontSize=24,r.autoRename=!1,r.characters="Name of assignee",r.name=D,n.appendChild(a),n.appendChild(o),a.appendChild(t),a.appendChild(e),o.appendChild(r),o.appendChild(i),e.layoutGrow=1,r.layoutGrow=1})).catch((()=>{figma.notify("Font '"+g.family+"' could not be loaded. Please install the font.")})),a.primaryAxisSizingMode="FIXED",a.layoutAlign="STRETCH",o.primaryAxisSizingMode="FIXED",o.layoutAlign="STRETCH",n}))}function L(){return e(this,void 0,void 0,(function*(){let e;const i=[yield b(R,"Status=Default"),yield b(w,"Status=To Do"),yield b(C,"Status=Concepting"),yield b(k,"Status=Design"),yield b(x,"Status=Testing"),yield b(N,"Status=Launch"),yield b(_,"Status=Error")];return e=figma.combineAsVariants(i,figma.currentPage),e.name=E,e.layoutMode="VERTICAL",e.counterAxisSizingMode="AUTO",e.primaryAxisSizingMode="AUTO",e.paddingTop=16,e.paddingRight=16,e.paddingBottom=16,e.paddingLeft=16,e.itemSpacing=24,e.cornerRadius=4,t.setPluginData("ticketComponentID",e.id),e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2,e}))}function H(e){if(!e)throw figma.notify("Something went wrong."),new Error("Something went wrong."+e);if("Error"==e.type)throw figma.notify("Could not get data. There seems to be no connection to the server."),new Error(e.message);if("Client must be authenticated to access this resource."==e[0].message)throw figma.notify("You have entered an invalid e-mail. See 'Authorization' settings."),new Error(e.message);if("Site temporarily unavailable"==e[0].errorMessage)throw figma.notify("Company domain name does not exist. See 'Project Settings'."),new Error(e[0].errorMessage);if(e[0][0])throw figma.notify("Could not access data. Your Jira API Token seems to be invalid. See 'Authorization' settings."),new Error(e[0][0]);return!0}function B(e,t){var i;return e&&e.key?i=e:"The issue no longer exists."==e.errorMessages?i=X(`Error: Ticket ID '${t}' does not exist.`,t):"Issue key is in an invalid format."==e.errorMessages?i=X(`Error: Ticket ID '${t}' is in an invalid format.`,t):(i=X("Error: An unexpected error occured.",t),figma.notify("Unexpected error."),console.error("Unexpected error.",e)),i}function X(e,t){return{key:t,fields:{summary:e,status:{name:"Error"},statuscategorychangedate:(new Date).toISOString()}}}function Y(e){var t=parseInt(e,16);return{r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}}"update_selection"===figma.command?F("selection"):"update_all"===figma.command?F("all"):"update_page"===figma.command?F("page"):(figma.showUI(__html__,{width:250,height:308}),z()),function(){e(this,void 0,void 0,(function*(){if(!M){var e=t.getPluginData("ticketComponentID");let i;M=e&&(i=figma.getNodeById(e))?i:yield L()}}))}(),figma.ui.onmessage=g=>e(this,void 0,void 0,(function*(){if("create-component"===g.type&&(M=yield L(),t.setPluginData("ticketComponentID",M.id)),"create-new-ticket"===g.type&&H(g.data)){let t=yield function(t){return e(this,void 0,void 0,(function*(){let e=M.defaultVariant.createInstance();e.x=figma.viewport.center.x-e.width/2+T,e.y=figma.viewport.center.y-e.height/2+T,T=(T+10)%70,figma.currentPage.selection=[e];let i=B(t.data[0],t.issueIds[0]);e=(yield U([e],t,!0))[0];let n=e.findOne((e=>"TEXT"===e.type&&e.name===S));return n?(yield figma.loadFontAsync(n.fontName),n.characters=i.key):figma.notify("Could not find text element named 'Ticket ID'."),e}))}(g);if(g.createLink&&g.data[0].key&&""!=l){let e=encodeURIComponent(figma.root.name),i=encodeURIComponent(t.id),n=`https://www.figma.com/file/${l}/${e}?node-id=${i}`;figma.ui.postMessage({issueId:g.issueIds[0],link:n,type:"post-link-to-jira-issue"})}}if("update-all"===g.type&&P("all"),"update-page"===g.type&&P("page"),"update-selected"===g.type&&P("selection"),"authorization-detail-changed"===g.type&&function(g,y,p=!1){e(this,void 0,void 0,(function*(){p?t.setPluginData(g,y):yield figma.clientStorage.setAsync(g,y),g===i?d=y:g===n?l=y:g===a?c=y:g===o?f=y:g===r?m=y:g===s&&(u=y)}))}(g.key,g.data,g.save_public),"resize-ui"===g.type&&(g.big_size?figma.ui.resize(250,650):figma.ui.resize(250,308)),"create-visual-bell"===g.type&&figma.notify(g.message),"ticketDataSent"===g.type&&H(g.data)){var y=g.nodeIds.map((e=>figma.getNodeById(e)));yield U(y,g)}}))}})[480]();